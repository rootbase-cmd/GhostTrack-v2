<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>dr. HighKali — AGI Console</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/static/dr_highkali_style.css">
</head>
<body>
  <div class="card"><h1>dr. HighKali</h1><div class="muted">AGI orchestratore — conoscenza dalla A alla Z. Non senziente.</div></div>
  <div class="card"><strong>Stato moduli</strong><div id="modules" class="muted" style="margin-top:8px">Caricamento…</div></div>
  <div class="card"><strong>Prompt rapido</strong><textarea id="prompt" rows="4" style="width:100%;margin-top:8px" placeholder="Chiedi a dr. HighKali..."></textarea><div style="margin-top:8px"><a id="askBtn" class="btn">Interroga</a></div></div>
  <div class="card"><strong>Safe Kill Audition</strong>
    <div class="muted" style="margin-top:8px">Scansiona testo, segnali o video e mette in quarantena elementi sospetti. Le azioni critiche richiedono approvazione umana.</div>
    <div style="margin-top:8px">
      <input id="sk_type" value="text" style="width:100%;margin-bottom:6px"/>
      <textarea id="sk_payload" rows="3" style="width:100%" placeholder='{"text":"..."} or {"signal":{"freq_change":0.6}}'></textarea>
      <a id="skScan" class="btn" style="margin-top:8px">Scan Safe Kill</a>
    </div>
  </div>
  <div class="card"><strong>Output</strong><pre id="output">Nessuna richiesta ancora eseguita.</pre></div>
  <script>
    const API_BASE = (window.GT_CONFIG && window.GT_CONFIG.api_base_url) ? window.GT_CONFIG.api_base_url : '/api';
    async function loadModules(){
      try{
        const r = await fetch(API_BASE + '/status');
        const j = await r.json();
        const modules = j.modules ? Object.keys(j.modules).map(m => '- ' + m).join('\\n') : 'Nessun modulo rilevato';
        document.getElementById('modules').textContent = modules;
      }catch(e){
        document.getElementById('modules').textContent = 'Impossibile contattare API: ' + e.message;
      }
    }
    document.getElementById('askBtn').addEventListener('click', async ()=>{
      const prompt = document.getElementById('prompt').value.trim();
      if(!prompt){ alert('Inserisci una richiesta sintetica'); return; }
      document.getElementById('output').textContent = 'Elaborazione in corso...';
      try{
        const r = await fetch(API_BASE + '/agi/query', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({agent:'dr_highkali', prompt})
        });
        const j = await r.json();
        document.getElementById('output').textContent = j.result || JSON.stringify(j, null, 2);
      }catch(e){
        document.getElementById('output').textContent = 'Errore: ' + e.message;
      }
    });
    document.getElementById('skScan').addEventListener('click', async ()=>{
      const typ = document.getElementById('sk_type').value || 'text';
      let payloadRaw = document.getElementById('sk_payload').value || '';
      let payload;
      try{ payload = JSON.parse(payloadRaw); }catch(e){ payload = payloadRaw; }
      document.getElementById('output').textContent = 'Scanning...';
      try{
        const r = await fetch(API_BASE + '/defense/safe_kill/scan', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({type: typ, payload: payload, source: 'ui'})
        });
        const j = await r.json();
        document.getElementById('output').textContent = JSON.stringify(j, null, 2);
      }catch(e){
        document.getElementById('output').textContent = 'Errore: ' + e.message;
      }
    });
    loadModules();
  </script>
</body>
</html>
